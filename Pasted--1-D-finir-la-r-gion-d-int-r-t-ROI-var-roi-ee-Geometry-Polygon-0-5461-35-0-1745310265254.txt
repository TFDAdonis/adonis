// ğŸ“ 1. DÃ©finir la rÃ©gion dâ€™intÃ©rÃªt (ROI)
var roi = ee.Geometry.Polygon([
  [
    [-0.5461, 35.0111],
    [-0.4771, 35.0111],
    [-0.4771, 35.0294],
    [-0.5461, 35.0294],
    [-0.5461, 35.0111]
  ]
]);

// ğŸ“† 2. FenÃªtre temporelle : 2014 Ã  2024
var years = ee.List.sequence(2014, 2024);

// ğŸ“¦ 3. Fonction pour charger et traiter les donnÃ©es Landsat
var getAnnualSI = function(year) {
  var startDate = ee.Date.fromYMD(year, 1, 1);
  var endDate = startDate.advance(1, 'year');

  // Charger la collection Landsat 8
  var collection = ee.ImageCollection("LANDSAT/LC08/C02/T1_L2")
    .filterBounds(roi)
    .filterDate(startDate, endDate)
    .filter(ee.Filter.lt('CLOUD_COVER', 20))
    .select(['SR_B5', 'SR_B6']) // NIR et SWIR1
    .map(function(image) {
      return image.divide(10000).copyProperties(image, image.propertyNames());
    });

  // Moyenne annuelle
  var meanImage = collection.mean();

  // Calcul de lâ€™indice de salinitÃ© : SI = SWIR1 / NIR
  var si = meanImage.expression(
    'SWIR1 / NIR', {
      'SWIR1': meanImage.select('SR_B6'),
      'NIR': meanImage.select('SR_B5')
    }).rename('SI');

  // Moyenne sur la zone
  var meanValue = si.reduceRegion({
    reducer: ee.Reducer.mean(),
    geometry: roi,
    scale: 30,
    bestEffort: true,
    maxPixels: 1e9
  });

  // Retourner un Feature (annÃ©e, valeur SI)
  return ee.Feature(null, {
    'year': year,
    'SI': meanValue.get('SI')
  });
};

// ğŸ“Š 4. Appliquer la fonction Ã  chaque annÃ©e
var stats = ee.FeatureCollection(years.map(getAnnualSI));

// ğŸ“ˆ 5. GÃ©nÃ©rer le graphique
var chart = ui.Chart.feature.byFeature(stats, 'year', ['SI'])
  .setChartType('LineChart')
  .setOptions({
    title: 'Ã‰volution annuelle de lâ€™Indice de SalinitÃ© (SI)',
    hAxis: {title: 'AnnÃ©e'},
    vAxis: {title: 'Indice de SalinitÃ© (SI)'},
    lineWidth: 2,
    pointSize: 5,
    series: {
      0: {color: 'red'}
    }
  });

print('ğŸ“ˆ Graphe de lâ€™indice de salinitÃ© 2014â€“2024', chart)